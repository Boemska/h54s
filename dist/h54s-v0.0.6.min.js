/*! h54s v0.0.6 - 2014-12-02 
 *  License: GPL 
 * Author: Boemska 
*/

var ajax=function(){var a=function(a,b,c){var d={success:function(){},error:function(){}},e=XMLHttpRequest||ActiveXObject,f=new e("MSXML2.XMLHTTP.3.0");return f.open(a,b,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"),f.onreadystatechange=function(){4===f.readyState&&(f.status>=200&&f.status<300?d.success.call(d,f):d.error.call(d,f))},f.send(c),{success:function(a){return d.success=a,this},error:function(a){return d.error=a,this}}},b=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")};return{get:function(c,d){var e;"object"==typeof d&&(e=b(d));var f=e?c+"?"+e:"";return a("GET",f)},post:function(c,d){var e;return"object"==typeof d&&(e=b(d)),a("POST",c,e)}}}();h54s=function(a){if(this.systemtype="SAS",this.counters={maxXhrRetries:5,finishedXhrCount:0,totalXhrCount:0},this.sasService="default",this.url="/SASStoredProcess/do",this.debug=!1,this.loginUrl="/SASLogon/Logon.do",a){for(var b in a)"url"!==b&&"loginUrl"!==b||"/"===a[b].charAt(0)||(a[b]="/"+a[b]),this[b]=a[b];a.hostUrl&&("/"===a.hostUrl.charAt(a.hostUrl.length-1)&&(a.hostUrl=a.hostUrl.slice(0,-1)),this.hostUrl=a.hostUrl,this.url=a.hostUrl+this.url)}},h54s.prototype.call=function(a,b){var c=this,d=arguments;if(!b&&"function"!=typeof b)throw new Error("You must provide callback");if(!a)throw new Error("You must provide Sas program file path");if("string"!=typeof a)throw new Error("First parameter should be string");var e;"WPS"==this.systemtype?e=this.metaProgram+".sas":"SAS"==this.systemtype&&(e=this.metaProgram),ajax.post(this.url,{_program:a,_debug:this.debug?1:0,_service:this.sasService}).success(function(a){/<form.+action="Logon.do".+/.test(a.responseText)&&c.autoLogin?c.logIn(function(a){200===a?c.call.apply(c,d):b(new Error("Unable to login"))}):/<form.+action="Logon.do".+/.test(a.responseText)&&!c.autoLogin?b(b(new Error("You are not logged in"))):b(void 0,a)}).error(function(a){b(a)})},h54s.prototype.setCredentials=function(a,b){if(!a||!b)throw new Error("Missing credentials");this.user=a,this.pass=b},h54s.prototype.logIn=function(){var a;if(!this.user&&!arguments[0]||!this.pass&&!arguments[1])throw new Error("Credentials not set");"string"==typeof arguments[0]&&"string"==typeof arguments[1]?(this.setCredentials(this.user||arguments[0],this.pass||arguments[1]),a=arguments[2]):a=arguments[0];var b=function(b){"function"==typeof a&&a(b)};this.hostUrl&&(this.loginUrl=this.hostUrl+this.loginUrl.slice()),ajax.post(this.loginUrl,{_debug:this.debug?1:0,_sasapp:"Stored Process Web App 9.3",_service:this.sasService,ux:this.user,px:this.pass}).success(function(a){b(a.status)}).error(function(a){b(a.status)})};
//# sourceMappingURL=h54s-v0.0.6.min.js.map