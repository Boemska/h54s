!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.h54s=e()}}(function(){return function e(t,r,o){function s(a,i){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!i&&l)return l(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){var r=t[a][1][e];return s(r?r:e)},u,u.exports,e,t,r,o)}return r[a].exports}for(var n="function"==typeof require&&require,a=0;a<o.length;a++)s(o[a]);return s}({1:[function(e,t,r){function o(e,t,r){Error.captureStackTrace&&Error.captureStackTrace(this),this.message=t,this.type=e,this.status=r}o.prototype=Object.create(Error.prototype,{constructor:{configurable:!1,enumerable:!1,writable:!1,value:o},name:{configurable:!1,enumerable:!1,writable:!1,value:"h54sError"}}),t.exports=o},{}],2:[function(e,t,r){function o(e,t){this._files={},o.prototype.add.call(this,e,t)}var s=e("../error.js");o.prototype.add=function(e,t){if(!e||!t)throw new s("argumentError","Missing arguments");if(!(e instanceof File||e instanceof Blob))throw new s("argumentError","First argument must be instance of File object");if("string"!=typeof t)throw new s("argumentError","Second argument must be string");if(!isNaN(t[t.length-1]))throw new s("argumentError","Macro name cannot have number at the end");this._files[t]=["FILE",e]},t.exports=o},{"../error.js":1}],3:[function(e,t,r){var o=e("./error.js"),s=t.exports=function(t){function r(e){if(!e)return void this._ajax.setTimeout(this.ajaxTimeout);if("object"!=typeof e)throw new o("argumentError","First parameter should be config object");for(var t in e)e.hasOwnProperty(t)&&("url"!==t&&"loginUrl"!==t||"/"===e[t].charAt(0)||(e[t]="/"+e[t]),this[t]=e[t]);e.hostUrl&&("/"===e.hostUrl.charAt(e.hostUrl.length-1)&&(e.hostUrl=e.hostUrl.slice(0,-1)),this.hostUrl=e.hostUrl,this.url=e.hostUrl+this.url,this.loginUrl=e.hostUrl+this.loginUrl,this.RESTauthLoginUrl=e.hostUrl+this.RESTauthLoginUrl),this._ajax.setTimeout(this.ajaxTimeout)}if(this.maxXhrRetries=5,this.url="/SASStoredProcess/do",this.debug=!1,this.loginUrl="/SASLogon/Logon.do",this.retryAfterLogin=!0,this.ajaxTimeout=3e4,this.useMultipartFormData=!0,this.RESTauth=!1,this.RESTauthLoginUrl="/SASLogon/v1/tickets",this.remoteConfigUpdateCallbacks=[],this._pendingCalls=[],this._ajax=e("./methods/ajax.js")(),r.call(this,t),t&&t.isRemoteConfig){var s=this;this._disableCalls=!0,this._ajax.get("h54sConfig.json").success(function(e){var o=JSON.parse(e.responseText);for(var n in o)o.hasOwnProperty(n)&&void 0===t[n]&&"isRemoteConfig"!==n&&(t[n]=o[n]);r.call(s,t);for(var a=0,i=s.remoteConfigUpdateCallbacks.length;a<i;a++){var l=s.remoteConfigUpdateCallbacks[a];l()}for(s._disableCalls=!1;s._pendingCalls.length>0;){var c=s._pendingCalls.shift(),u=c.sasProgram,p=c.callback,f=c.params;s.metadataRoot&&c.params._program.indexOf(s.metadataRoot)===-1&&(c.params._program=s.metadataRoot.replace(/\/?$/,"/")+c.params._program.replace(/^\//,"")),f._debug=s.debug?131:0,s.call(u,null,p,f)}}).error(function(e){throw new o("ajaxError","Remote config file cannot be loaded. Http status code: "+e.status)})}};s.version="0.11.3",s.prototype=e("./methods"),s.Tables=e("./tables"),s.Files=e("./files"),s.SasData=e("./sasData.js"),s.fromSasDateTime=e("./methods/utils.js").fromSasDateTime,s.toSasDateTime=e("./tables/utils.js").toSasDateTime,e("./ie_polyfills.js")},{"./error.js":1,"./files":2,"./ie_polyfills.js":4,"./methods":7,"./methods/ajax.js":6,"./methods/utils.js":8,"./sasData.js":9,"./tables":10,"./tables/utils.js":11}],4:[function(e,t,r){t.exports=function(){Object.create||(Object.create=function(e,t){function r(){}if("undefined"!=typeof t)throw"The multiple-argument version of Object.create is not provided by this browser and cannot be shimmed.";return r.prototype=e,new r}),Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=r.length;return function(s){if("object"!=typeof s&&("function"!=typeof s||null===s))throw new TypeError("Object.keys called on non-object");var n,a,i=[];for(n in s)e.call(s,n)&&i.push(n);if(t)for(a=0;a<o;a++)e.call(s,r[a])&&i.push(r[a]);return i}}()),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t,r,o=Object(this),s=o.length>>>0;if(0===s)return-1;for(t=s-1,arguments.length>1&&(t=Number(arguments[1]),t!=t?t=0:0!==t&&t!=1/0&&t!=-(1/0)&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),r=t>=0?Math.min(t,s-1):s-Math.abs(t);r>=0;r--)if(r in o&&o[r]===e)return r;return-1})}()},{}],5:[function(e,t,r){var o={applicationLogs:[],debugData:[],sasErrors:[],failedRequests:[]},s={applicationLogs:100,debugData:20,failedRequests:20,sasErrors:100};t.exports.get={getSasErrors:function(){return o.sasErrors},getApplicationLogs:function(){return o.applicationLogs},getDebugData:function(){return o.debugData},getFailedRequests:function(){return o.failedRequests}},t.exports.clear={clearApplicationLogs:function(){o.applicationLogs.splice(0,o.applicationLogs.length)},clearDebugData:function(){o.debugData.splice(0,o.debugData.length)},clearSasErrors:function(){o.sasErrors.splice(0,o.sasErrors.length)},clearFailedRequests:function(){o.failedRequests.splice(0,o.failedRequests.length)},clearAllLogs:function(){this.clearApplicationLogs(),this.clearDebugData(),this.clearSasErrors(),this.clearFailedRequests()}},t.exports.addApplicationLog=function(e,t){if("blank"!==e){var r={message:e,time:new Date,sasProgram:t};o.applicationLogs.push(r),o.applicationLogs.length>s.applicationLogs&&o.applicationLogs.shift()}},t.exports.addDebugData=function(e,t,r,n){o.debugData.push({debugHtml:e,debugText:t,sasProgram:r,params:n,time:new Date}),o.debugData.length>s.debugData&&o.debugData.shift()},t.exports.addFailedRequest=function(e,t,r){o.failedRequests.push({responseHtml:e,responseText:t,sasProgram:r,time:new Date}),o.failedRequests.length>s.failedRequests&&o.failedRequests.shift()},t.exports.addSasErrors=function(e){for(o.sasErrors=o.sasErrors.concat(e);o.sasErrors.length>s.sasErrors;)o.sasErrors.shift()}},{}],6:[function(e,t,r){t.exports=function(){var e,t=3e4,r=function(r,o,s,n){var a={success:function(){},error:function(){}},i=XMLHttpRequest||ActiveXObject,l=new i("MSXML2.XMLHTTP.3.0");return l.open(r,o,!0),n||l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),l.onreadystatechange=function(){4===l.readyState&&(clearTimeout(e),l.status>=200&&l.status<300?a.success.call(a,l):a.error.call(a,l))},t>0&&(e=setTimeout(function(){l.abort()},t)),l.send(s),{success:function(e){return a.success=e,this},error:function(e){return a.error=e,this}}},o=function(e){var t=[];for(var r in e)if(e.hasOwnProperty(r))if(e[r]instanceof Array)for(var o=0,s=e[r].length;o<s;o++)t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r][o]));else t.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));return t.join("&")},s=function(e){var t=new FormData;for(var r in e)if(e.hasOwnProperty(r))if(e[r]instanceof Array)for(var o=0,s=e[r].length;o<s;o++)t.append(r,e[r][o]);else t.append(r,e[r]);return t};return{get:function(e,t){var s;"object"==typeof t&&(s=o(t));var n=s?e+"?"+s:e;return r("GET",n)},post:function(e,t,n){var a;return"object"==typeof t&&(a=n?s(t):o(t)),r("POST",e,a,n)},setTimeout:function(e){t=e}}}},{}],7:[function(e,t,r){function o(e,t,r){var o=this,s={_service:"default",ux:e,px:t,username:e,password:t};for(var n in this._aditionalLoginParams)s[n]=this._aditionalLoginParams[n];this._loginAttempts=0,this._ajax.post(this.loginUrl,s).success(function(e){if(3===++o._loginAttempts)return r(-2);if(o._utils.needToLogin.call(o,e))if(o._loginChanged||o._isNewLoginPage&&!o._aditionalLoginParams){delete o._loginChanged;var t=e.responseText.match(/<input.*"hidden"[^>]*>/g);t&&t.forEach(function(e){var t=e.match(/name="([^"]*)"\svalue="([^"]*)/);s[t[1]]=t[2]});var n=this.success,i=this.error;o._ajax.post(o.loginUrl,s).success(function(){o._ajax.get(o.url).success(n).error(i)}).error(this.error)}else a.addApplicationLog("Wrong username or password"),r(-1);else for(r(e.status),o._disableCalls=!1;o._pendingCalls.length>0;){var l=o._pendingCalls.shift(),c=l.method||o.call.bind(o),u=l.sasProgram,p=l.callback,f=l.params;f._debug=o.debug?131:0,o.retryAfterLogin&&c(u,null,p,f)}}).error(function(e){a.addApplicationLog("Login failed with status code: "+e.status),r(e.status)})}function s(e,t,r){var o=this,s={username:e,password:t};this._ajax.post(this.RESTauthLoginUrl,s).success(function(e){var t=e.getResponseHeader("Location");o._ajax.post(t,{service:o.url}).success(function(e){o.url.indexOf("?")===-1?o.url+="?ticket="+e.responseText:o.url.indexOf("ticket")!==-1?o.url=o.url.replace(/ticket=[^&]+/,"ticket="+e.responseText):o.url+="&ticket="+e.responseText,r(e.status)}).error(function(e){a.addApplicationLog("Login failed with status code: "+e.status),r(e.status)})}).error(function(e){"error.authentication.credentials.bad"===e.responseText?r(-1):(a.addApplicationLog("Login failed with status code: "+e.status),r(e.status))})}var n=e("../error.js"),a=e("../logs.js"),i=e("../tables"),l=e("../sasData.js"),c=e("../files");t.exports.call=function(e,t,r,o){var s=this,u=0,p=this.debug;if(!r||"function"!=typeof r)throw new n("argumentError","You must provide callback");if(!e)throw new n("argumentError","You must provide Sas program file path");if("string"!=typeof e)throw new n("argumentError","First parameter should be string");if(this.useMultipartFormData===!1&&!(t instanceof i))throw new n("argumentError","Cannot send files using application/x-www-form-urlencoded. Please use Tables or default value for useMultipartFormData");if(o||(o={_program:this._utils.getFullProgramPath(this.metadataRoot,e),_debug:this.debug?131:0,_service:"default"}),t){var f,h;if(t instanceof i)h=t._tables;else{if(!(t instanceof c||t instanceof l))throw new n("argumentError","Wrong type of tables object");h=t._files}for(f in h)h.hasOwnProperty(f)&&(o[f]=h[f])}return this._disableCalls?void this._pendingCalls.push({sasProgram:e,callback:r,params:o}):void this._ajax.post(this.url,o,this.useMultipartFormData).success(function(l){if(s._utils.needToLogin.call(s,l)){if(s._pendingCalls.push({sasProgram:e,callback:r,params:o}),s._disableCalls)return;s._disableCalls=!0,r(new n("notLoggedinError","You are not logged in"))}else{var c,f,h,g=!1;if(p)try{c=s._utils.parseDebugRes(l.responseText,e,o),a.addApplicationLog(c.logmessage,e),f=t instanceof i?s._utils.unescapeValues(c):c,"success"!==c.status&&(h=new n("programError",c.errormessage,c.status)),g=!0}catch(d){d instanceof SyntaxError?(h=new n("parseError",d.message),g=!0):d instanceof n?"parseError"===d.type&&u<1?(g=!1,s._ajax.post(s.url,o,s.useMultipartFormData).success(this.success).error(this.error),u++,a.addApplicationLog("Retrying #"+u,e)):(h=d instanceof n?d:new n("parseError","Unable to parse response json"),g=!0):(h=new n("unknownError",d.message),h.stack=d.stack,g=!0)}finally{g&&r(h,f)}else try{c=s._utils.parseRes(l.responseText,e,o),a.addApplicationLog(c.logmessage,e),f=t instanceof i?s._utils.unescapeValues(c):c,"success"!==c.status&&(h=new n("programError",c.errormessage,c.status)),g=!0}catch(d){d instanceof SyntaxError?u<s.maxXhrRetries?(g=!1,s._ajax.post(s.url,o,s.useMultipartFormData).success(this.success).error(this.error),u++,a.addApplicationLog("Retrying #"+u,e)):(s._utils.parseErrorResponse(l.responseText,e),s._utils.addFailedResponse(l.responseText,e),h=new n("parseError","Unable to parse response json"),g=!0):d instanceof n?(s._utils.parseErrorResponse(l.responseText,e),s._utils.addFailedResponse(l.responseText,e),h=d,g=!0):(s._utils.parseErrorResponse(l.responseText,e),s._utils.addFailedResponse(l.responseText,e),h=new n("unknownError",d.message),h.stack=d.stack,g=!0)}finally{g&&r(h,f)}}}).error(function(t){401===t.status?r(new n("notLoggedinError","You are not logged in")):(a.addApplicationLog("Request failed with status: "+t.status,e),r(new n("httpError",t.statusText)))})},t.exports.login=function(e,t,r){if(!e||!t)throw new n("argumentError","Credentials not set");if("string"!=typeof e||"string"!=typeof t)throw new n("argumentError","User and pass parameters must be strings");if(!r||"function"!=typeof r)throw new n("argumentError","You must provide callback");this.RESTauth?s.call(this,e,t,r):o.call(this,e,t,r)},t.exports.logout=function(e){this._ajax.get(this.url,{_action:"logoff"}).success(function(t){e()}).error(function(t){a.addApplicationLog("Logout failed with status code: "+t.status),e(t.status)})},t.exports.setDebugMode=function(){this.debug=!0},t.exports.unsetDebugMode=function(){this.debug=!1};for(var u in a.get)a.get.hasOwnProperty(u)&&(t.exports[u]=a.get[u]);for(var u in a.clear)a.clear.hasOwnProperty(u)&&(t.exports[u]=a.clear[u]);t.exports.onRemoteConfigUpdate=function(e){this.remoteConfigUpdateCallbacks.push(e)},t.exports._utils=e("./utils.js")},{"../error.js":1,"../files":2,"../logs.js":5,"../sasData.js":9,"../tables":10,"./utils.js":8}],8:[function(e,t,r){var o=e("../logs.js"),s=e("../error.js"),n=/<title>(Stored Process Error|SASStoredProcess)<\/title>[\s\S]*<h2>(Stored process not found:.*|.*not a valid stored process path.)<\/h2>/,a=function(e){return e.replace(/(\r\n|\r|\n)/g,"").replace(/\\\\(n|r|t|f|b)/g,"\\$1").replace(/\\"\\"/g,'\\"')};t.exports.parseRes=function(e,t,r){var o=e.match(n);if(o)throw new s("programNotFound","You have not been granted permission to perform this action, or the STP is missing.");return JSON.parse(a(e))},t.exports.parseDebugRes=function(e,t,r){var i=e.match(n);if(i)throw new s("programNotFound","You have not been granted permission to perform this action, or the STP is missing.");patt=/^(.?--h54s-data-start--)([\S\s]*?)(--h54s-data-end--)/m,i=e.match(patt);var l=e.replace(patt,""),c=/<body.*>([\s\S]*)<\/body>/,u=l.match(c),p=u[1].replace(/<[^>]*>/g,"");if(p=this.decodeHTMLEntities(p),o.addDebugData(u[1],p,t,r),this.parseErrorResponse(e,t))throw new s("sasError","Sas program completed with errors");if(!i)throw new s("parseError","Unable to parse response json");var f=JSON.parse(a(i[2]));return f},t.exports.addFailedResponse=function(e,t){var r=/<script([\s\S]*)\/form>/,s=/display\s?:\s?none;?\s?/;e=e.replace(r,"").replace(s,"");var n=e.replace(/<[^>]*>/g,"");n=this.decodeHTMLEntities(n),o.addFailedRequest(e,n,t)},t.exports.unescapeValues=function(e){for(var t in e)"string"==typeof e[t]?e[t]=decodeURIComponent(e[t]):"object"==typeof e&&this.unescapeValues(e[t]);return e},t.exports.parseErrorResponse=function(e,t){var r=/^ERROR(:\s|\s\d\d)(.*\.|.*\n.*\.)/gm,s=e.replace(/(<([^>]+)>)/gi,"").match(r);if(s){for(var n,a=0,i=s.length;a<i;a++)n=s[a].replace(/<[^>]*>/g,"").replace(/(\n|\s{2,})/g," "),n=this.decodeHTMLEntities(n),s[a]={sasProgram:t,message:n,time:new Date};return o.addSasErrors(s),!0}},t.exports.decodeHTMLEntities=function(e){var t=document.createElement("span"),r=e.replace(/&(#(?:x[0-9a-f]+|\d+)|[a-z]+);/gi,function(e){return t.innerHTML=e,e=t.textContent||t.innerText});return r},t.exports.fromSasDateTime=function(e){var t=new Date("January 1, 1960 00:00:00"),r=e,o=t.getTimezoneOffset(),s=t.getTime(),n=1e3*r,a=n+s,i=new Date;i.setTime(a);var l=i.getTimezoneOffset(),c=60*(o-l)*1e3,u=a-c;return i.setTime(u),i},t.exports.needToLogin=function(e){var t,r=/<form.+action="(.*Logon[^"]*).*>/,o=r.exec(e.responseText);if(o){var s=o[1].replace(/\?.*/,"");if("/"===s.charAt(0))t=this.hostUrl?this.hostUrl+s:s,t!==this.loginUrl&&(this._loginChanged=!0,this.loginUrl=t);else{var n=e.responseURL.lastIndexOf("/")+1,a=e.responseURL.substr(0,n).replace(/.*\/{2}[^\/]*/,"")+s;t=this.hostUrl?this.hostUrl+a:a,t!==this.loginUrl&&(this._loginChanged=!0,this.loginUrl=t)}var i=e.responseText.match(/<input.*"hidden"[^>]*>/g),l={};return i&&(this._isNewLoginPage=!0,i.forEach(function(e){var t=e.match(/name="([^"]*)"\svalue="([^"]*)/);l[t[1]]=t[2]}),this._aditionalLoginParams=l),!0}return!1},t.exports.getFullProgramPath=function(e,t){return e?e.replace(/\/?$/,"/")+t.replace(/^\//,""):t}},{"../error.js":1,"../logs.js":5}],9:[function(e,t,r){function o(e){if(e.length>32)throw new n("argumentError","Table name too long. Maximum is 32 characters");var t=e.charCodeAt(0);if((t<65||t>90)&&(t<97||t>122)&&"_"!==e[0])throw new n("argumentError","Table name starting with number or special characters");for(var r=0;r<e.length;r++){var o=e.charCodeAt(r);if((o<48||o>57)&&(o<65||o>90)&&(o<97||o>122)&&"_"!==e[r])throw new n("argumentError","Table name has unsupported characters")}}function s(e,t,r){if(e instanceof Array)this._files={},this.addTable(e,t,r);else{if(!(e instanceof File||e instanceof Blob))throw new n("argumentError","Data argument wrong type or missing");i.call(this,e,t)}}var n=e("./error.js"),a=e("./logs.js"),i=(e("./tables"),e("./files")),l=e("./tables/utils.js").toSasDateTime;s.prototype.addTable=function(e,t,r){var s=!!r;if(!e||!t)throw new n("argumentError","Missing arguments");if(!(e instanceof Array))throw new n("argumentError","First argument must be array");if("string"!=typeof t)throw new n("argumentError","Second argument must be string");if(o(t),"object"!=typeof e||!(e instanceof Array))throw new n("argumentError","Table argument is not an array");var i;if(r){if(r.constructor!==Object)throw new n("argumentError","Specs data type wrong. Object expected.");for(i in e[0])if(!r[i])throw new n("argumentError","Missing columns in specs data.");for(i in r){if(r[i].constructor!==Object)throw new n("argumentError","Wrong column descriptor in specs data.");if(!r[i].colType||!r[i].colLength)throw new n("argumentError","Missing columns in specs descriptor.")}}var c,u,p,f,h,g=[],d=['"',"\\","/","\n","\t","\f","\r","\b"];if(r)g=Object.keys(r);else for(r={},c=0;c<e.length;c++){if(p=e[c],"object"!=typeof p)throw new n("argumentError","Table item is not an object");for(i in p)p.hasOwnProperty(i)&&(f=p[i],h=typeof f,void 0===r[i]&&(g.push(i),r[i]={},"number"===h?((f<Number.MIN_SAFE_INTEGER||f>Number.MAX_SAFE_INTEGER)&&a.addApplicationLog("Object["+c+"]."+i+" - This value exceeds expected numeric precision."),r[i].colType="num",r[i].colLength=8):"string"!==h||f instanceof Date?f instanceof Date?(r[i].colType="date",r[i].colLength=8):"object"===h&&(r[i].colType="json",r[i].colLength=JSON.stringify(f).length):(r[i].colType="string",r[i].colLength=f.length)))}var m="";for(c=0;c<e.length;c++){for(p=e[c],u=0;u<g.length;u++){if(i=g[u],p.hasOwnProperty(i)){if(f=p[i],h=typeof f,"number"===h&&isNaN(f))throw new n("typeError","NaN value in one of the values (columns) is not allowed");if(f===-(1/0)||f===1/0)throw new n("typeError",f.toString()+" value in one of the values (columns) is not allowed");if(f===!0||f===!1)throw new n("typeError","Boolean value in one of the values (columns) is not allowed");if("string"===h&&f.indexOf("\n")!==-1)throw new n("typeError","New line character is not supported");if(null===f)if("string"===r[i].colType)f="",h="string";else{if("num"!==r[i].colType)throw new n("typeError","Cannot convert null value");f=".",h="number"}if("number"===h&&"num"!==r[i].colType&&"."!==f||"string"===h&&!(f instanceof Date)&&"string"!==r[i].colType&&"string"===h&&"num"==r[i].colType&&"."!==f||f instanceof Date&&"date"!==r[i].colType||"object"===h&&f.constructor!==Date&&"json"!==r[i].colType)throw new n("typeError","There is a specs type mismatch in the array between values (columns) of the same name. type/colType/val = "+h+"/"+r[i].colType+"/"+f);if(!s&&"string"===h&&r[i].colLength<f.length)r[i].colLength=f.length;else if("string"===h&&r[i].colLength<f.length||"string"!==h&&8!==r[i].colLength)throw new n("typeError","There is a specs length mismatch in the array between values (columns) of the same name. type/colType/val = "+h+"/"+r[i].colType+"/"+f);switch(f instanceof Date&&(f=l(f)),r[i].colType){case"num":case"date":m+=f;break;case"string":m+='"'+f.replace(/"/g,'""')+'"';for(var w=f.length,b=0;b<f.length;b++)if(d.indexOf(f[b])!==-1)w++;else{var y=f.charCodeAt(b);y>65535?w+=3:y>2047?w+=2:y>127&&(w+=1)}r[i].colLength=Math.max(r[i].colLength,w,1);break;case"object":m+='"'+JSON.stringidy(f).replace(/"/g,'""')+'"'}}u<g.length-1&&(m+=",")}c<e.length-1&&(m+="\n")}var v=g.map(function(e){return e+","+r[e].colType+","+r[e].colLength}).join("|");this._files[t]=[v,new Blob([m],{type:"text/csv;charset=UTF-8"})]},s.prototype.addFile=function(e,t){i.prototype.add.call(this,e,t)},t.exports=s},{"./error.js":1,"./files":2,"./logs.js":5,"./tables":10,"./tables/utils.js":11}],10:[function(e,t,r){function o(e,t,r){this._tables={},this._parameterThreshold=r||3e4,o.prototype.add.call(this,e,t)}var s=e("../error.js");o.prototype.add=function(e,t){if(!e||!t)throw new s("argumentError","Missing arguments");if(!(e instanceof Array))throw new s("argumentError","First argument must be array");if("string"!=typeof t)throw new s("argumentError","Second argument must be string");if(!isNaN(t[t.length-1]))throw new s("argumentError","Macro name cannot have number at the end");var r=this._utils.convertTableObject(e,this._parameterThreshold),o=[];o.push(JSON.stringify(r.spec));for(var n=0;n<r.data.length;n++){var a=JSON.stringify(r.data[n]);o.push(a)}this._tables[t]=o},o.prototype._utils=e("./utils.js"),t.exports=o},{"../error.js":1,"./utils.js":11}],11:[function(e,t,r){var o=e("../error.js"),s=e("../logs.js");t.exports.convertTableObject=function(e,t){function r(e){return"undefined"==typeof a[e.colName]?(a[e.colName]={},a[e.colName].colName=e.colName,a[e.colName].colType=e.colType,a[e.colName].colLength=e.colLength>0?e.colLength:1,0):a[e.colName].colType!==e.colType?-1:a[e.colName].colLength<e.colLength?(a[e.colName].colLength=e.colLength>0?e.colLength:1,0):void 0}if(t>3e4&&console.warn("You should not set threshold larger than 30kb because of the SAS limitations"),"object"!=typeof e)throw new o("argumentError","The parameter passed to checkAndGetTypeObject is not an object");var n=e.length;if("number"!=typeof n)throw new o("argumentError","The parameter passed to checkAndGetTypeObject does not have a valid length and is most likely not an array");var a={},i=0,l=[],c=0;l[c]=[];for(var u=0,p=0;p<e.length;p++){l[c][u]={};var f=0;for(var h in e[p]){var g={},d=e[p][h];if(void 0!==d&&null!==d){if("number"==typeof d&&isNaN(d))throw new o("typeError","NaN value in one of the values (columns) is not allowed");if(d===-(1/0)||d===1/0)throw new o("typeError",d.toString()+" value in one of the values (columns) is not allowed");if(d===!0||d===!1)throw new o("typeError","Boolean value in one of the values (columns) is not allowed");var m=typeof d;if("number"===m)(d<Number.MIN_SAFE_INTEGER||d>Number.MAX_SAFE_INTEGER)&&s.addApplicationLog("Object["+p+"]."+h+" - This value exceeds expected numeric precision."),g.colName=h,g.colType="num",g.colLength=8,g.encodedLength=d.toString().length,l[c][u][h]=d;else if("string"===m)g.colName=h,g.colType="string",g.colLength=d.length,""===d?l[c][u][h]=" ":l[c][u][h]=encodeURIComponent(d).replace(/'/g,"%27"),g.encodedLength=l[c][u][h].length;else{if(d instanceof Date)throw new o("typeError","Date type not supported. Please use h54s.toSasDateTime function to convert it");"object"==m&&(g.colName=h,g.colType="json",g.colLength=JSON.stringify(d).length,l[c][u][h]=encodeURIComponent(JSON.stringify(d)).replace(/'/g,"%27"),g.encodedLength=l[c][u][h].length)}if(f=f+6+h.length+g.encodedLength,r(g)==-1)throw new o("typeError","There is a type mismatch in the array between values (columns) of the same name.")}}if(0!==Object.keys(l[c][u]).length){if(f>t)throw new o("argumentError","Row "+u+" exceeds size limit of 32kb");if(i+f>t){var w=l[c].pop();c++,l[c]=[w],u=0,i=f}else i+=f;u++}else l[c].splice(u,1)}var b=[];for(var y in a)b.push(a[y]);return{spec:b,data:l,jsonLength:i}},t.exports.toSasDateTime=function(e){var t=new Date("January 1, 1960 00:00:00"),r=e,o=t.getTimezoneOffset(),s=r.getTimezoneOffset(),n=60*(s-o),a=t.getTime()/1e3,i=r.getTime()/1e3,l=Math.round(i-a-n);return l}},{"../error.js":1,"../logs.js":5}]},{},[3])(3)});
